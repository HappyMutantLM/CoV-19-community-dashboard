---
title: 
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

\pagenumbering{gobble}

```{r include=FALSE}
source("Functions.R")
source("Constants and dependencies.R")

USA_VHA_JHU_data <- build_USA_VHA_JHU_data()
USA_VHA_TCP_data <- build_USA_VHA_TCP_data ()
USA_VHA_JHU_clean_data = merge_census(data = USA_VHA_JHU_data, geography = "county")
USA_VHA_TCP_clean_data = merge_census(data = USA_VHA_TCP_data, geography = "state")

```

```{r include=FALSE}

## Filter for the states that correspond to the selected VISN ##
 VISN_states = USA_VHA_JHU_clean_data %>%
    select(State, VISN) %>%
    distinct() %>%
    filter(VISN == selected_VISN) %>%
  filter(grepl(paste(VISN_primary_states, collapse = "|"), State))

 
## Build the table with VISN data
## using the {current_days} value.
  TCP_epidemiology_VISN = USA_VHA_TCP_clean_data %>%
    filter(state%in% unique(VISN_states$State),
           date >= (max(date) - days(current_days))
    )
  table_1_VISN = make_table_1(TCP_epidemiology_VISN)
  
## Build the table with USA dta
  TCP_epidemiology_USA = USA_VHA_TCP_clean_data %>%
    filter( date >= (max(date) - days(current_days)))
  table_1_USA = make_table_1(TCP_epidemiology_USA)
  
## Merge the VISN and USA data tables and add row names  
  table_1 = rbind(table_1_VISN, table_1_USA)
  rownames(table_1) <- c(paste("VISN", selected_VISN, "states"), "U.S.A")


```

```{r echo=FALSE}
## Format the TCP data table ##
table_TCP_data <- table_1 %>%
 select(current_prevalence, overall_prevalence, currently_hospitalized,
        rate_hospitalized, current_CFR, overall_CFR,
        currently_ICU, currently_vent)
kable(table_TCP_data, "latex", booktabs = TRUE, 
      col.names = c("Current", "Overall", "Current","Overall",
                    "Current", "Overall",
                     "Currently ICU", "Currently Ventilator"
                    )
      ) %>%
  kable_styling(latex_options = "striped", full_width = TRUE, font_size = 12) %>%
  footnote(number = c("Data: The COVID Project")) %>%
  column_spec(1, bold = TRUE) %>%
  add_header_above(c(" ", "Prevalence" = 2, "Hospitalized" = 2, "CFR" = 2, " " = 2)) %>%
  add_header_above(c("Current & Overall CoV-19 Community Epidemiology" = 9),
                   italic = TRUE, font_size = 14) %>%
  landscape()


```